import{r as u}from"./iframe-JcCZxaL9.js";import{F as z}from"./Field-3Q5sMdHm.js";import{t as _}from"./styles-KzE9S3ri.js";import{r as L,f as F,u as q,c as k}from"./index-D3fR3lML.js";import{a as O}from"./fieldA11y-BYzskgUw.js";import{r as $}from"./randomId-Dfhrkieu.js";import{u as U}from"./useElementBounds-ybLDVOMu.js";import{f as W}from"./fireInputChange-BU1kNzof.js";function K(e,r){const n=u.useRef(null),t=e||n,l=u.useRef(null),a=r||l;return u.useEffect(()=>{const i=t.current,c=a.current;if(i&&c){let m=function(){P(i,c)};return P(i,c),i.addEventListener("scroll",m),()=>{i.removeEventListener("scroll",m)}}},[t,a]),[t,a]}function P(e,r){e&&r&&(r.scrollLeft=e.scrollLeft,r.scrollTop=e.scrollTop)}const B=L({slots:{visibleInputsContainer:"relative",placeholderInput:`
      select-none pointer-events-none
      text-gray-400 disabled:text-gray-400
    `,workingInput:"peer absolute top-0 right-0 left-0 !bg-transparent",formInput:"hidden",currencySymbol:`
      absolute left-0.5
      select-none pointer-events-none
      text-black
      peer-placeholder-shown:text-gray-400 
      peer-disabled:text-gray-400 
      font-medium
    `},variants:{sizer:{xs:{currencySymbol:"text-xs pl-2 pr-1 top-1.75"},sm:{currencySymbol:"text-sm pl-2.25 pr-1.5 top-2"},base:{currencySymbol:"text-base pl-3 pr-2 top-3"},lg:{currencySymbol:"text-lg pl-4 pr-2 top-4"},xl:{currencySymbol:"text-xl pl-4.5 pr-2.5 top-5"}},isInitialized:{false:{placeholderInput:"text-transparent disabled:text-transparent",workingInput:"text-transparent disabled:text-transparent",currencySymbol:"text-transparent"}},isSpread:{true:{workingInput:"static mt-3",formInput:"block bg-white border-1 mt-3 select-none pointer-events-none"}}},defaultVariants:{sizer:"base",isInitialized:!0,isSpread:!1}});function j(e){return u.useCallback(r=>{if(r.metaKey)return!1;if(![...v,e.decimalPoint,...e.allowNegatives?["-"]:[],"ArrowUp","ArrowDown","ArrowLeft","ArrowRight","ArrowRight","Tab","Enter","Backspace","Delete"].includes(r.key)&&r.key!==e.decimalPoint)return!0;const n=r.currentTarget.value,t=r.currentTarget.selectionStart||0,l=(r.currentTarget.selectionEnd||0)!==t;if(r.key===e.decimalPoint&&n.indexOf(e.decimalPoint)!==-1||r.key==="-"&&(t>0||n.indexOf("-")!==-1))return!0;if(v.includes(r.key)&&!l){const a=n.indexOf(e.decimalPoint);if(a!==-1&&t>a&&n.length-(a+1)>=e.decimalPlaces.max)return!0}},[e.allowNegatives,e.decimalPlaces.max,e.decimalPoint])}const v=Object.freeze(["0","1","2","3","4","5","6","7","8","9"]);function p(e,r){let n=e?.toString().replace(/[^0-9.-]/g,"")||"";if(!r.allowWorkingNegativeSign&&n==="-"||n.indexOf("-")>0||V(n,"-")>(r.allowNegatives?1:0)||V(n,".")>1)return"";const t=n.match(/^(-?)0+(([1-9][0-9]*)|0)(\.[0-9]*)?$/);if(t&&(n=(t[1]||"")+(t[2]||"")+(t[4]||"")),n[0]==="."?n=`0${n}`:n.slice(0,2)==="-."&&(n=`-0${n.slice(1)}`),!r?.allowWorkingDecimalPoint&&n[n.length-1]==="."&&(n=n.slice(0,-1)),n&&r.decimalPlaces.min>0){let[l,a]=n.split(".");n=`${l==="-"?"-0":l||"0"}.${(a||"").padEnd(r.decimalPlaces.min,"0")}`}if(n&&r.decimalPlaces.max===0){let[l]=n.split(".");n=l}else{let[l,a]=n.split(".");a&&a.length>r.decimalPlaces.max&&([l,a]=(Math.round(+`${l}.${a}`*Math.pow(10,r.decimalPlaces.max))/Math.pow(10,r.decimalPlaces.max)).toString().split("."),n=`${l==="-"?"-0":l}.${(a||"").padEnd(r.decimalPlaces.min,"0")}`)}return!r.allowWorkingNegativeSign&&n.match(/^-0(\.(0+)?)?$/)&&(n=n.slice(1)),n}function E(e,r){const n=p(e,r);if(n==="")return"";const[t,l]=n.split("."),a=n.indexOf(".")!==-1,i=3,c=Math.ceil(t.length/i),m=t.length%i||i,d=[t.substring(0,m)];for(var f=0;f<c-1;f++)d.push(t.substring(m+f*i,m+(f+1)*i));return`${d.join(r.thousandsSeparator)}${a?r.decimalPoint:""}${l||""}`}function T(e,r){return e.replaceAll(r.thousandsSeparator,"").replace(r.decimalPoint,".")}function H(e,r,n){return[r-V(e.workingValue.slice(0,r),e.format.thousandsSeparator)*e.format.thousandsSeparator.length,n-V(e.workingValue.slice(0,n),e.format.thousandsSeparator)*e.format.thousandsSeparator.length]}function V(e,r){return e.split(r).length-1}const I=F((e,r,n,t,l,a)=>({currencySymbol:e,decimalPoint:r,decimalPlaces:{min:n,max:t},thousandsSeparator:l,allowNegatives:a}));function x(e){return typeof e=="object"?e:{min:e,max:e}}function Z(e){return u.useReducer(G,e,R)}function R({controlledValue:e,defaultValue:r,format:n}){const t=e!==void 0?e:r,l=p(t,n);return{currentValue:{version:1,formValue:l,workingValue:l===""?"":y(t,n),placeholderValue:y(t,n),controlledValue:e,format:n,source:"initialValue"}}}function g(e,r){return{currentValue:{...e.currentValue,...r,version:e.currentValue?.version+1},previousValue:e?.currentValue}}function G(e,r){let n;switch(r.type){case"REINITIALIZE_WITH_VALUE":return R({...r.payload,format:e.currentValue.format});case"UPDATE_FROM_CONTROLLED_VALUE":if(r.payload===e.currentValue.controlledValue)return e;n=p(r.payload,e.currentValue.format);const l=Number(n)!==Number(e.currentValue.formValue)||n===""&&e.currentValue.formValue!==""||n!==""&&e.currentValue.formValue==="";return g(e,{formValue:n,workingValue:l?w(n,e.currentValue.format):e.currentValue.workingValue,placeholderValue:l?y(n,e.currentValue.format):e.currentValue.placeholderValue,controlledValue:r.payload,source:"controlledValue"});case"UPDATE_FROM_WORKING_VALUE":var t=T(r.payload,e.currentValue.format);return n=p(t,e.currentValue.format),g(e,{formValue:n,workingValue:w(t,e.currentValue.format),placeholderValue:y(t,e.currentValue.format),source:"workingValue"});case"UPDATE_FORMAT":var t=T(e.currentValue.workingValue,e.currentValue.format);return g(e,{formValue:p(t,r.payload),workingValue:t===""?"":y(t,r.payload),placeholderValue:y(t,r.payload),format:r.payload,source:"format"});case"INCREMENT_VALUE":if(e.currentValue.formValue===""&&r.payload<0?n=p(0,e.currentValue.format):n=p(Math.max(Number(e.currentValue.formValue)+r.payload,e.currentValue.format.allowNegatives?-1/0:0),e.currentValue.format),n===e.currentValue.formValue)return e;const[a]=n.split(".");let i=n.replace(/^-?[0-9]*/,"");const c=e.currentValue.workingValue.replace(/^-?[0-9]*/,"");return(Number(i)||0)===(Number(c)||0)&&(i=c),g(e,{formValue:n,workingValue:w(`${a}${i}`,e.currentValue.format),placeholderValue:y(n,e.currentValue.format),source:"increment"})}}function w(e,r){return E(e,{...r,allowWorkingDecimalPoint:!0,allowWorkingNegativeSign:!0,decimalPlaces:{min:0,max:r.decimalPlaces.max}})}function y(e,r){return E(e||"0",{...r,allowWorkingDecimalPoint:!0,allowWorkingNegativeSign:!0})}function Y(e){const[{currentValue:r,previousValue:n},t]=Z(e),l=u.useCallback(c=>{t({type:"UPDATE_FROM_WORKING_VALUE",payload:c})},[t]),a=u.useCallback(c=>{t({type:"INCREMENT_VALUE",payload:c})},[t]),i=u.useCallback(c=>{t({type:"REINITIALIZE_WITH_VALUE",payload:c})},[t]);return u.useEffect(()=>{e.format!==r.format&&t({type:"UPDATE_FORMAT",payload:e.format})},[e.format,r.format,t]),u.useEffect(()=>{e.controlledValue!==r.controlledValue&&t({type:"UPDATE_FROM_CONTROLLED_VALUE",payload:e.controlledValue})},[e.controlledValue,r.controlledValue,t]),{previousValue:n,currentValue:r,updateFromWorkingValue:l,incrementValue:a,reinitializeWithValue:i}}function J(e){const r=u.useRef(null),n=u.useRef(null),t=u.useRef(null),[l,a]=u.useState(!1),[i,c]=u.useState(!1),m=x(e.decimalPlaces??2),d=I(e.currencySymbol??"$",e.decimalPoint??".",m.min,m.max,e.thousandsSeparator??",",e.allowNegatives||!1),f=I(d.currencySymbol,d.decimalPoint,d.decimalPlaces.min,d.decimalPlaces.max,"",d.allowNegatives),{currentValue:s,previousValue:h,reinitializeWithValue:N,updateFromWorkingValue:D,incrementValue:S}=Y({controlledValue:e.value,defaultValue:e.defaultValue,format:i?f:d});u.useEffect(()=>{s.formValue!==h?.formValue&&s.source!=="controlledValue"&&s.source!=="initialValue"&&W(t.current,s.formValue)},[s.formValue,h?.formValue,s.source]),u.useEffect(()=>{if(r.current&&r.current.value!==s.workingValue){const o={start:r.current.selectionStart||0,end:r.current.selectionEnd||0};if(r.current.value=s.workingValue,h&&document.activeElement===r.current&&(s.source==="format"&&r.current.setSelectionRange(...H(h,o.start,o.end)),s.source==="increment")){const b=s.formValue.length-h.formValue.length;r.current.setSelectionRange(o.start+b,o.end+b)}}},[s,h,r]);const A=j(d);function C(o){if(A(o)){o.preventDefault();return}o.key==="ArrowUp"&&(o.preventDefault(),S(o.shiftKey?10:1)),o.key==="ArrowDown"&&(o.preventDefault(),S(o.shiftKey?-10:-1)),e.onKeyDown?.(o)}u.useLayoutEffect(()=>{if(e.value===void 0&&e.defaultValue===void 0){const o=t.current?.value;o!=null&&o!==""&&N({defaultValue:o})}},[]);const{className:ee,sizer:re,label:ne,hint:te,error:ae,currencySymbol:le,decimalPoint:oe,decimalPlaces:ie,thousandsSeparator:ue,allowNegatives:ce,"data-nickui-component":se,...M}=e;return{workingInput:{...M,ref:r,onChange:o=>D(o.target.value),onKeyDown:C,onFocus:o=>{!l&&!i&&c(!0),e.onFocus?.(o)},onBlur:o=>{i&&c(!1),t.current&&e.onBlur?.({...o,target:t.current,currentTarget:t.current})},onMouseDown:o=>{!l&&a(!0),e.onMouseDown?.(o)},onMouseUp:o=>{l&&a(!1),!i&&c(!0),e.onMouseUp?.(o)},value:void 0,defaultValue:void 0,name:void 0},placeholderInput:{ref:n,value:s.placeholderValue,onChange:()=>{}},formInput:{ref:o=>{t.current=o,typeof e.ref=="function"?e.ref(o):e.ref&&(e.ref.current=o)},onChange:e.onChange,defaultValue:s.formValue}}}function Q(e){const r=O({label:e.label,hint:e.hint,error:e.error,controlledId:e.id,controlledAriaLabel:e["aria-label"],controlledAriaLabelledBy:e["aria-labelledby"],controlledAriaDescribedBy:e["aria-describedby"],controlledAriaErrorMessage:e["aria-errormessage"],controlledAriaInvalid:e["aria-invalid"]}),n=J(e),t=e.currencySymbol??"$",l=u.useRef(null),a=U(l),[i]=u.useState($()),c=x(e.decimalPlaces??2).min>0;K(n.workingInput.ref,n.placeholderInput.ref);const m=q(e.sizer),d=_({sizer:m,hasError:!!e.error}),f=B({sizer:m,isInitialized:!t||!!a,isSpread:!!e.docsMeta?.spread}),s=e["aria-label"]&&!r.formControl["aria-labelledby"]?void 0:`${r.formControl["aria-labelledby"]||""} ${i}`;return u.createElement(z,{...r.field,className:e.className,sizer:e.sizer,label:e.label,hint:e.hint,error:e.error!==!0?e.error:void 0,required:e.required,"data-nickui-component":e["data-nickui-component"]||"Money"},u.createElement("div",{className:f.visibleInputsContainer()},u.createElement("input",{type:"text",disabled:e.disabled,className:k(d,f.placeholderInput()),style:a?{paddingLeft:a.width}:{},tabIndex:-1,"aria-hidden":!0,"data-testid":"placeholder-input",...n.placeholderInput}),u.createElement("input",{...r.formControl,role:"spinbutton",inputMode:e.allowNegatives?"text":c?"decimal":"numeric","aria-labelledby":s,disabled:e.disabled,required:e.required,className:k(d,f.workingInput()),style:a?{paddingLeft:a.width}:{},placeholder:" ",...n.workingInput}),t&&u.createElement("div",{ref:l,id:i,className:f.currencySymbol(),"data-testid":"currency-symbol",title:`(in ${t})`,"aria-hidden":!0},t)),u.createElement("input",{name:e.name,className:f.formInput(),tabIndex:-1,"aria-hidden":!0,...n.formInput}))}Q.__docgenInfo={description:`A form control that allows users to enter a monetary amount
@param props {@link MoneyProps}`,methods:[],displayName:"Money",props:{sizer:{required:!1,tsType:{name:"union",raw:"SizerType | SizerType[]",elements:[{name:"unknown[number]",raw:"(typeof SIZERS)[number]"},{name:"Array",elements:[{name:"unknown[number]",raw:"(typeof SIZERS)[number]"}],raw:"SizerType[]"}]},description:`Changes the size of the component. A sizer string, or an array of sizer
strings for responsive sizing.`},label:{required:!1,tsType:{name:"DescriptorType"},description:"The main label to show above the form control(s), naming the field"},hint:{required:!1,tsType:{name:"DescriptorType"},description:`A hint about what kind of value the field accepts, such as a phone
number format`},error:{required:!1,tsType:{name:"DescriptorType"},description:"Error message to show beneath the form control(s), or just `true` to\ntrigger the error style without showing an error message."},required:{required:!1,tsType:{name:"boolean"},description:"When `true`, adds an asterisk to the label"},disabled:{required:!1,tsType:{name:"boolean"},description:"Prevents the user from interacting with the component"},value:{required:!1,tsType:{name:"ValueType"},description:`Sets the value of the component when using it as a
[controlled component](https://react.dev/reference/react-dom/components/input#controlling-an-input-with-a-state-variable)`},defaultValue:{required:!1,tsType:{name:"ValueType"},description:"Sets the value of the component when using it as an uncontrolled component"},name:{required:!1,tsType:{name:"string"},description:"The name of the field"},currencySymbol:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:'The currency symbol shown at the front of the input, typically "$"'},decimalPoint:{required:!1,tsType:{name:"string"},description:`The character separating the whole part from the decimal part, typically
"."`},thousandsSeparator:{required:!1,tsType:{name:"string"},description:`The character to use to separate every three digits in the whole part,
typically ","`},decimalPlaces:{required:!1,tsType:{name:"union",raw:`| number
| {
    min: number;
    max: number;
  }`,elements:[{name:"number"},{name:"signature",type:"object",raw:`{
  min: number;
  max: number;
}`,signature:{properties:[{key:"min",value:{name:"number",required:!0}},{key:"max",value:{name:"number",required:!0}}]}}]},description:`Controls how many decimal places the user is allowed to add, and how many
will always be included on the value emitted via the onChange handler.
Typically 2.`},allowNegatives:{required:!1,tsType:{name:"boolean"},description:"Set to `true` to allow the user to enter negative values"},"data-nickui-component":{required:!1,tsType:{name:"string"},description:""},docsMeta:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** Set to \`true\` to show all 3 inputs */
  spread?: boolean;
}`,signature:{properties:[{key:"spread",value:{name:"boolean",required:!1},description:"Set to `true` to show all 3 inputs"}]}},description:"docs-specific options. Not meant to be used in prod!"}}};const{expect:X}=__STORYBOOK_MODULE_TEST__;async function be(e,r,n=50,t=1e3){async function l(){return new Promise(a=>{e.value===r&&a(!0);const i=setInterval(()=>{e.value===r&&(clearInterval(i),a(!0))},n);setTimeout(()=>{clearInterval(i),a(!0)},t)})}await l(),X(e).toHaveValue(r)}export{Q as M,be as e};
