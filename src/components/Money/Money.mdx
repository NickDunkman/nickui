import { Canvas, Meta, Source } from '@storybook/addon-docs/blocks';

import Docs from '@/dev/docBlocks';

import { Money } from './Money';
import * as stories from './Money.stories';

<Meta of={stories} />

<Docs.ComponentHeading of="Money" />

A form control that allows users to enter a monetary amount.

The displayed value is automatically formatted according to the specified
configuration, though will “deformat” as you edit the field, since it can feel
disorienting when the changes don’t match your keystrokes.

If you’re interested, check out the
[How it works](/docs/form-controls-money--how-it-works) write-up!

<Docs.FauxCanvas>
  <Money defaultValue="1234567.89" />
</Docs.FauxCanvas>

<Docs.TableOfContents />

<Docs.Props of={stories} nativeBase="input" wrapper="Field" />

<Docs.ControlStates
  of={stories}
  valuable
  note={`
    Note: when controlled, <ComponentName of="Money" /> behaves slightly
    differently from other form controls. Since the input’s value needs to be
    disconnected from the controlled \`value\` to enable currency formatting,
    the input’s value can change even if you aren’t passing in the new
    controlled value. However, if you do pass in a numerically different
    controlled value, everything will cascade accordingly.
  `}
/>

## Currency formatting & constraints

To customize the currency format, you can use a combination of the
`currencySymbol`, `decimalPoint`, and `thousandsSeparator` props. They all use
USD defaults.

The `decimalPlaces` prop defaults to `2` and configures:

- the maximum number of decimal places the user can enter
- the number of "placeholder" decimal places that are suggested as you type
- the number of decimal places always included on `onChange(event.target.value)`

`decimalPlaces` also takes a min/max object, if you want to allow the user to
add even more decimal places than is suggested by the placeholder. You can see
that in action here, where the Bitcoin field suggests 8 decimal places, but the
user can add up to 10.

<Canvas
  of={stories.currencyConverter}
  source={{
    language: 'tsx',
    code: stories.currencyConverter.parameters.source,
  }}
/>

By default, negative values are not allowed, since typically, a monetary field
is either positive (like in a deposit form), or negative represented with a
positive value (like in a withdrawal form). However, you can allow negatives
using the `allowNegatives` prop.

Keep in mind that if you allow negatives, the user won’t be able to use the
simpler numeric keyboard on mobile devices, since it doesn’t include a key for
the negative sign.

<Canvas of={stories.allowNegatives} />

## Working with the value

You can pass any of these forms in through either the `value` or `defaultValue`
props:

- `undefined`
- a `number`
- a numeric `string` such as `"1234.56"` or `""`. It should be parseable as a
  `Number()`. For example, while `"17,50"` is how a number might be formatted in
  many countries, it’s not a number as far as javascript is concerned (`"17.50"`
  is).

When the user updates edits the field, use the `onChange` handler to receive the
updated value. `event.target.value` is **always** a string in javascript, so the
updated value will be in the form of a string.

You might choose to just use strings through, like this:

<Source
  dark
  language="tsx"
  code={`
    const [value, setValue] = React.useState('1234.56');

    <Money
      label="My money field"
      value={value}
      onChange={(event) => setValue(event.target.value)}
    />

`} />

Or, you could convert updated values back to numbers, like this:

<Source
  dark
  language="tsx"
  code={`
    const [value, setValue] = React.useState<number | undefined>(1234.56);

    <Money
      label="My money field"
      value={value}
      onChange={(event) => setValue(
        event.target.value === '' ? undefined : Number(event.target.value)
      )}
    />

`} />

<Docs.Sizers of={stories} wrapper="Field" />

<Docs.FormLibraryDemos of="Money" fieldName="greensFees" initialValue="137.00">
  {({ props, error }) => (
    <Money
      {...props}
      label="Greens fees"
      hint="Try editting me!"
      error={error}
    />
  )}
</Docs.FormLibraryDemos>
