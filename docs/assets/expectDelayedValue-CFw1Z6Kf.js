import{r as c}from"./iframe-D7K3DBLU.js";import{F as C}from"./Field-CtUzKpbc.js";import{t as _}from"./styles-DSTw06ym.js";import{r as A,f as z,u as O,c as T}from"./index-69CadyKP.js";import{a as L}from"./fieldA11y-BMp6F0pm.js";import{r as q}from"./randomId-Dfhrkieu.js";import{u as $}from"./useElementBounds-D6FJn0lD.js";import{f as U}from"./fireInputChange-BU1kNzof.js";function W(e,r){const t=c.useRef(null),n=e||t,a=c.useRef(null),l=r||a;return c.useEffect(()=>{const o=n.current,s=l.current;if(o&&s){let u=function(){I(o,s)};return I(o,s),o.addEventListener("scroll",u),()=>{o.removeEventListener("scroll",u)}}},[n,l]),[n,l]}function I(e,r){e&&r&&(r.scrollLeft=e.scrollLeft,r.scrollTop=e.scrollTop)}const F=A({slots:{visibleInputsContainer:"relative",placeholderInput:`
      select-none pointer-events-none
      text-gray-400 disabled:text-gray-400
    `,workingInput:"peer absolute top-0 right-0 left-0 !bg-transparent",formInput:"hidden",currencySymbol:`
      absolute left-0.5
      select-none pointer-events-none
      text-black
      peer-placeholder-shown:text-gray-400 
      peer-disabled:text-gray-400 
      font-medium
    `},variants:{sizer:{xs:{currencySymbol:"text-xs pl-2 pr-1 top-1.75"},sm:{currencySymbol:"text-sm pl-2.25 pr-1.5 top-2"},base:{currencySymbol:"text-base pl-3 pr-2 top-3"},lg:{currencySymbol:"text-lg pl-4 pr-2 top-4"},xl:{currencySymbol:"text-xl pl-4.5 pr-2.5 top-5"}},isInitialized:{false:{placeholderInput:"text-transparent disabled:text-transparent",workingInput:"text-transparent disabled:text-transparent",currencySymbol:"text-transparent"}},isSpread:{true:{workingInput:"static mt-3",formInput:"block bg-white border-1 mt-3 select-none pointer-events-none"}}},defaultVariants:{sizer:"base",isInitialized:!0,isSpread:!1}});function K(e){return c.useCallback(r=>{if(r.metaKey)return!1;if(![...v,e.decimalPoint,...e.allowNegatives?["-"]:[],"ArrowUp","ArrowDown","ArrowLeft","ArrowRight","ArrowRight","Tab","Enter","Backspace","Delete"].includes(r.key)&&r.key!==e.decimalPoint)return!0;const t=r.currentTarget.value,n=r.currentTarget.selectionStart||0,a=(r.currentTarget.selectionEnd||0)!==n;if(r.key===e.decimalPoint&&t.indexOf(e.decimalPoint)!==-1||r.key==="-"&&(n>0||t.indexOf("-")!==-1))return!0;if(v.includes(r.key)&&!a){const l=t.indexOf(e.decimalPoint);if(l!==-1&&n>l&&t.length-(l+1)>=e.decimalPlaces.max)return!0}},[e.allowNegatives,e.decimalPlaces.max,e.decimalPoint])}const v=Object.freeze(["0","1","2","3","4","5","6","7","8","9"]);function f(e,r,{allowWorkingDecimals:t=!1,allowWorkingNegative:n=!1}={}){let a=e?.toString().replace(/[^0-9.-]/g,"")||"";if(a==="-")return n?"-":"";if(a.indexOf("-")>0||k(a,"-")>(r.allowNegatives?1:0)||k(a,".")>1)return"";const l=a.match(/^(-?)0+(([1-9][0-9]*)|0)(\.[0-9]*)?$/);if(l&&(a=(l[1]||"")+(l[2]||"")+(l[4]||"")),a[0]==="."?a=`0${a}`:a.slice(0,2)==="-."&&(a=`-0${a.slice(1)}`),!t&&a[a.length-1]==="."&&(a=a.slice(0,-1)),a&&r.decimalPlaces.max===0){let[o]=a.split(".");a=o}else{let[o,s]=a.split(".");s&&s.length>r.decimalPlaces.max&&([o,s]=(Math.round(+`${o}.${s}`*Math.pow(10,r.decimalPlaces.max))/Math.pow(10,r.decimalPlaces.max)).toString().split("."),a=`${o==="-"?"-0":o}.${(s||"").padEnd(r.decimalPlaces.min,"0")}`)}if(a&&!t){let[o,s]=a.split(".");const u=(s||"").replace(/0+$/,"").padEnd(r.decimalPlaces.min,"0");a=`${o==="-"&&u.length>0?"-0":o}${u.length>0?".":""}${u}`}return!n&&a.match(/^-0(\.(0+)?)?$/)&&(a=a.slice(1)),a}function P(e,r,{allowWorkingDecimals:t=!1,allowWorkingNegative:n=!1,allowThousandsSeparators:a=!0}={}){const l=f(e,r,{allowWorkingDecimals:t,allowWorkingNegative:n});if(l==="")return"";const[o,s]=l.split("."),u=l.indexOf(".")!==-1;let d;if(!a)d=o;else{const w=Math.ceil(o.length/3),p=o.length%3||3,b=[o.substring(0,p)];for(var m=0;m<w-1;m++)b.push(o.substring(p+m*3,p+(m+1)*3));d=b.join(r.thousandsSeparator)}return`${d}${u?r.decimalPoint:""}${s||""}`}function E(e,r){return e.replaceAll(r.thousandsSeparator,"").replace(r.decimalPoint,".")}function B(e,r,t){return[r-k(e.workingValue.slice(0,r),e.format.thousandsSeparator)*e.format.thousandsSeparator.length,t-k(e.workingValue.slice(0,t),e.format.thousandsSeparator)*e.format.thousandsSeparator.length]}function k(e,r){return e.split(r).length-1}const j=z((e,r,t,n,a,l)=>({currencySymbol:e,decimalPoint:r,decimalPlaces:{min:t,max:n},thousandsSeparator:a,allowNegatives:l}));function M(e){return typeof e=="object"?e:{min:e,max:e}}function G(e){return c.useReducer(H,e,R)}function R({controlledValue:e,defaultValue:r,workingMode:t=!1,format:n}){const l=f(e!==void 0?e:r,n);return{currentValue:{version:1,workingMode:t,formValue:l,workingValue:h(l,n,t,!0),placeholderValue:y(l,n,t),controlledValue:e,format:n,source:"initialValue"}}}function V(e,r){return{currentValue:{...e.currentValue,...r,version:e.currentValue?.version+1},previousValue:e?.currentValue}}function H(e,r){let t;switch(r.type){case"REINITIALIZE_WITH_VALUE":return R({...r.payload,format:e.currentValue.format});case"UPDATE_FROM_CONTROLLED_VALUE":if(r.payload===e.currentValue.controlledValue)return e;t=f(r.payload,e.currentValue.format);const a=Number(t)!==Number(e.currentValue.formValue)||t===""&&e.currentValue.formValue!==""||t!==""&&e.currentValue.formValue==="";return V(e,{formValue:t,workingValue:a?h(t,e.currentValue.format,e.currentValue.workingMode):e.currentValue.workingValue,placeholderValue:a?y(t,e.currentValue.format,e.currentValue.workingMode):e.currentValue.placeholderValue,controlledValue:r.payload,source:"controlledValue"});case"UPDATE_FROM_WORKING_VALUE":var n=E(r.payload,e.currentValue.format);return t=f(n,e.currentValue.format),V(e,{formValue:t,workingValue:h(n,e.currentValue.format,e.currentValue.workingMode),placeholderValue:y(n,e.currentValue.format,e.currentValue.workingMode),source:"workingValue"});case"UPDATE_FORMAT":var n=E(e.currentValue.workingValue,e.currentValue.format);return V(e,{formValue:f(n,r.payload),workingValue:h(n,r.payload,e.currentValue.workingMode),placeholderValue:y(n,r.payload,e.currentValue.workingMode),format:r.payload,source:"format"});case"INCREMENT_VALUE":if(e.currentValue.formValue===""&&r.payload<0?t=f(0,e.currentValue.format):t=f(Math.max(Number(e.currentValue.formValue)+r.payload,e.currentValue.format.allowNegatives?-1/0:0),e.currentValue.format),t===e.currentValue.formValue)return e;const[l]=t.split(".");let o=t.replace(/^-?[0-9]*/,"");const s=e.currentValue.workingValue.replace(/^-?[0-9]*/,"");return(Number(o)||0)===(Number(s)||0)&&(o=s),V(e,{formValue:t,workingValue:h(`${l}${o}`,e.currentValue.format,e.currentValue.workingMode),placeholderValue:y(t,e.currentValue.format,e.currentValue.workingMode),source:"increment"});case"SET_WORKING_MODE":case"SET_IDLE_MODE":const u=r.type==="SET_WORKING_MODE";var n=E(e.currentValue.workingValue,e.currentValue.format);return V(e,{workingMode:u,workingValue:h(n,e.currentValue.format,u),placeholderValue:y(n,e.currentValue.format,u),source:u?"workingMode":"idleMode"})}}function h(e,r,t,n=!1){return P(e,r,{allowWorkingDecimals:t&&!n,allowWorkingNegative:t,allowThousandsSeparators:!t})}function y(e,r,t){return P(e||"0",r,{allowWorkingDecimals:!1,allowWorkingNegative:t,allowThousandsSeparators:!t})}function Z(e){const[{currentValue:r,previousValue:t},n]=G(e),a=c.useCallback(d=>n({type:"UPDATE_FROM_WORKING_VALUE",payload:d}),[n]),l=c.useCallback(d=>n({type:"INCREMENT_VALUE",payload:d}),[n]),o=c.useCallback(d=>n({type:"REINITIALIZE_WITH_VALUE",payload:d}),[n]),s=c.useCallback(()=>!r.workingMode&&n({type:"SET_WORKING_MODE"}),[n,r.workingMode]),u=c.useCallback(()=>r.workingMode&&n({type:"SET_IDLE_MODE"}),[n,r.workingMode]);return c.useEffect(()=>{e.format!==r.format&&n({type:"UPDATE_FORMAT",payload:e.format})},[e.format,r.format,n]),c.useEffect(()=>{e.controlledValue!==r.controlledValue&&n({type:"UPDATE_FROM_CONTROLLED_VALUE",payload:e.controlledValue})},[e.controlledValue,r.controlledValue,n]),{previousValue:t,currentValue:r,updateFromWorkingValue:a,incrementValue:l,reinitializeWithValue:o,setWorkingMode:s,setIdleMode:u}}function Y(e){const r=c.useRef(null),t=c.useRef(null),n=c.useRef(null),[a,l]=c.useState(!1),o=M(e.decimalPlaces??2),s=j(e.currencySymbol??"$",e.decimalPoint??".",o.min,o.max,e.thousandsSeparator??",",e.allowNegatives||!1),{currentValue:u,previousValue:d,reinitializeWithValue:m,updateFromWorkingValue:g,incrementValue:w,setWorkingMode:p,setIdleMode:b}=Z({controlledValue:e.value,defaultValue:e.defaultValue,format:s});c.useEffect(()=>{u.formValue!==d?.formValue&&u.source!=="controlledValue"&&u.source!=="initialValue"&&U(n.current,u.formValue)},[u.formValue,d?.formValue,u.source]),c.useEffect(()=>{if(r.current&&r.current.value!==u.workingValue){const i={start:r.current.selectionStart||0,end:r.current.selectionEnd||0};if(r.current.value=u.workingValue,d&&document.activeElement===r.current&&(u.source==="workingMode"&&r.current.setSelectionRange(...B(d,i.start,i.end)),u.source==="increment")){const S=u.formValue.length-d.formValue.length;r.current.setSelectionRange(i.start+S,i.end+S)}}},[u,d,r]);const x=K(s);function D(i){if(x(i)){i.preventDefault();return}i.key==="ArrowUp"&&(i.preventDefault(),w(i.shiftKey?10:1)),i.key==="ArrowDown"&&(i.preventDefault(),w(i.shiftKey?-10:-1)),e.onKeyDown?.(i)}c.useLayoutEffect(()=>{if(e.value===void 0&&e.defaultValue===void 0){const i=n.current?.value;i!=null&&i!==""&&m({defaultValue:i})}},[]);const{className:X,sizer:ee,label:re,hint:ne,error:te,currencySymbol:ae,decimalPoint:le,decimalPlaces:oe,thousandsSeparator:ue,allowNegatives:ie,"data-nickui-component":ce,...N}=e;return{workingInput:{...N,ref:r,onChange:i=>g(i.target.value),onKeyDown:D,onFocus:i=>{!a&&p(),e.onFocus?.(i)},onBlur:i=>{b(),n.current&&e.onBlur?.({...i,target:n.current,currentTarget:n.current})},onMouseDown:i=>{!a&&l(!0),e.onMouseDown?.(i)},onMouseUp:i=>{a&&l(!1),p(),e.onMouseUp?.(i)},value:void 0,defaultValue:void 0,name:void 0},placeholderInput:{ref:t,value:u.placeholderValue,onChange:()=>{}},formInput:{ref:i=>{n.current=i,typeof e.ref=="function"?e.ref(i):e.ref&&(e.ref.current=i)},onChange:e.onChange,defaultValue:u.formValue}}}function J(e){const r=L({label:e.label,hint:e.hint,error:e.error,controlledId:e.id,controlledAriaLabel:e["aria-label"],controlledAriaLabelledBy:e["aria-labelledby"],controlledAriaDescribedBy:e["aria-describedby"],controlledAriaErrorMessage:e["aria-errormessage"],controlledAriaInvalid:e["aria-invalid"]}),t=Y(e),n=e.currencySymbol??"$",a=c.useRef(null),l=$(a),[o]=c.useState(q()),s=M(e.decimalPlaces??2).min>0;W(t.workingInput.ref,t.placeholderInput.ref);const u=O(e.sizer),d=_({sizer:u,hasError:!!e.error}),m=F({sizer:u,isInitialized:!n||!!l,isSpread:!!e.docsMeta?.spread}),g=e["aria-label"]&&!r.formControl["aria-labelledby"]?void 0:`${r.formControl["aria-labelledby"]||""} ${o}`;return c.createElement(C,{...r.field,className:e.className,sizer:e.sizer,label:e.label,hint:e.hint,error:e.error!==!0?e.error:void 0,required:e.required,"data-nickui-component":e["data-nickui-component"]||"Money"},c.createElement("div",{className:m.visibleInputsContainer()},c.createElement("input",{type:"text",disabled:e.disabled,className:T(d,m.placeholderInput()),style:l?{paddingLeft:l.width}:{},tabIndex:-1,"aria-hidden":!0,"data-testid":"placeholder-input",...t.placeholderInput}),c.createElement("input",{...r.formControl,role:"spinbutton",inputMode:e.allowNegatives?"text":s?"decimal":"numeric","aria-labelledby":g,disabled:e.disabled,required:e.required,className:T(d,m.workingInput()),style:l?{paddingLeft:l.width}:{},placeholder:" ",...t.workingInput}),n&&c.createElement("div",{ref:a,id:o,className:m.currencySymbol(),"data-testid":"currency-symbol",title:`(in ${n})`,"aria-hidden":!0},n)),c.createElement("input",{name:e.name,className:m.formInput(),tabIndex:-1,"aria-hidden":!0,...t.formInput}))}J.__docgenInfo={description:`A form control that allows users to enter a monetary value
@param props {@link MoneyProps}`,methods:[],displayName:"Money",props:{sizer:{required:!1,tsType:{name:"union",raw:"SizerType | SizerType[]",elements:[{name:"unknown[number]",raw:"(typeof SIZERS)[number]"},{name:"Array",elements:[{name:"unknown[number]",raw:"(typeof SIZERS)[number]"}],raw:"SizerType[]"}]},description:`Changes the size of the component. A sizer string, or an array of sizer
strings for responsive sizing.`},label:{required:!1,tsType:{name:"DescriptorType"},description:"The main label to show above the form control(s), naming the field"},hint:{required:!1,tsType:{name:"DescriptorType"},description:`A hint about what kind of value the field accepts, such as a phone
number format`},error:{required:!1,tsType:{name:"DescriptorType"},description:"Error message to show beneath the form control(s), or just `true` to\ntrigger the error style without showing an error message."},required:{required:!1,tsType:{name:"boolean"},description:"When `true`, adds an asterisk to the label"},disabled:{required:!1,tsType:{name:"boolean"},description:"Prevents the user from interacting with the component"},value:{required:!1,tsType:{name:"ValueType"},description:`Sets the value of the component when using it as a
[controlled component](https://react.dev/reference/react-dom/components/input#controlling-an-input-with-a-state-variable)`},defaultValue:{required:!1,tsType:{name:"ValueType"},description:"Sets the value of the component when using it as an uncontrolled component"},name:{required:!1,tsType:{name:"string"},description:"The name of the field"},currencySymbol:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:'The currency symbol shown at the front of the input, typically "$"'},decimalPoint:{required:!1,tsType:{name:"string"},description:`The character separating the whole part from the decimal part, typically
"."`},thousandsSeparator:{required:!1,tsType:{name:"string"},description:`The character to use to separate every three digits in the whole part,
typically ","`},decimalPlaces:{required:!1,tsType:{name:"union",raw:`| number
| {
    min: number;
    max: number;
  }`,elements:[{name:"number"},{name:"signature",type:"object",raw:`{
  min: number;
  max: number;
}`,signature:{properties:[{key:"min",value:{name:"number",required:!0}},{key:"max",value:{name:"number",required:!0}}]}}]},description:`Controls how many decimal places the user is allowed to add, and how many
will always be included on the value emitted via the onChange handler.
Typically 2.`},allowNegatives:{required:!1,tsType:{name:"boolean"},description:"Set to `true` to allow the user to enter negative values"},"data-nickui-component":{required:!1,tsType:{name:"string"},description:""},docsMeta:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** Set to \`true\` to show all 3 inputs */
  spread?: boolean;
}`,signature:{properties:[{key:"spread",value:{name:"boolean",required:!1},description:"Set to `true` to show all 3 inputs"}]}},description:"docs-specific options. Not meant to be used in prod!"}}};const{expect:Q}=__STORYBOOK_MODULE_TEST__;async function ge(e,r,t=50,n=1e3){async function a(){return new Promise(l=>{e.value===r&&l(!0);const o=setInterval(()=>{e.value===r&&(clearInterval(o),l(!0))},t);setTimeout(()=>{clearInterval(o),l(!0)},n)})}await a(),Q(e).toHaveValue(r)}export{J as M,ge as e};
